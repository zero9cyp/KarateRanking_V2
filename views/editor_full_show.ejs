<div class="container mt-4">
  <h3 class="text-center mb-3">🏅 Διαχείριση Αθλητή: <%= athlete.full_name %></h3>

  <!-- ✅ Κατάσταση Ελέγχου -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h5>
      Κατάσταση Ελέγχου:
      <% if (athlete.review_status === 'ok') { %>
        <span class="badge bg-success">✅ Εντάξει</span>
      <% } else if (athlete.review_status === 'issue') { %>
        <span class="badge bg-danger">⚠️ Πρόβλημα</span>
      <% } else { %>
        <span class="badge bg-secondary">⏳ Εκκρεμεί</span>
      <% } %>
    </h5>

    <form method="POST" action="/editor-full/review-status/<%= athlete.id %>" class="d-flex gap-2">
      <button name="status" value="ok" class="btn btn-success btn-sm">✅ Εντάξει</button>
      <button name="status" value="issue" class="btn btn-danger btn-sm">⚠️ Πρόβλημα</button>
      <button name="status" value="pending" class="btn btn-secondary btn-sm">⏳ Εκκρεμεί</button>
    </form>
  </div>

  <hr>

  <!-- 🧭 Tabs -->
  <ul class="nav nav-tabs mt-3" id="editorTabs" role="tablist">
    <li class="nav-item">
      <button class="nav-link active" id="profile-tab" data-bs-toggle="tab" data-bs-target="#profile" type="button">Προφίλ</button>
    </li>
    <li class="nav-item">
      <button class="nav-link" id="results-tab" data-bs-toggle="tab" data-bs-target="#results" type="button">Αποτελέσματα</button>
    </li>
    <li class="nav-item">
      <button class="nav-link" id="points-tab" data-bs-toggle="tab" data-bs-target="#points" type="button">Πόντοι</button>
    </li>
    <li class="nav-item">
      <button class="nav-link" id="seasons-tab" data-bs-toggle="tab" data-bs-target="#seasons" type="button">Εποχές</button>
    </li>
  </ul>

  <div class="tab-content" id="editorTabsContent">

    <!-- 🧍 Προφίλ -->
    <div class="tab-pane fade show active p-3" id="profile">
      <form action="/editor-full/<%= athlete.id %>/profile/update" method="POST" class="row g-3">
        <div class="col-md-6">
          <label class="form-label">Full Name</label>
          <input type="text" name="full_name" value="<%= athlete.full_name %>" class="form-control">
        </div>

        <div class="col-md-3">
          <label class="form-label">Birth Date</label>
          <input type="date" name="birth_date" value="<%= athlete.birth_date %>" class="form-control">
        </div>

        <div class="col-md-3">
          <label class="form-label">Gender</label>
          <select name="gender" class="form-select">
            <option value="male" <%= athlete.gender === 'male' ? 'selected' : '' %>>Male</option>
            <option value="female" <%= athlete.gender === 'female' ? 'selected' : '' %>>Female</option>
          </select>
        </div>

        <div class="col-md-3">
          <label class="form-label">Age Category</label>
          <select name="age_category_id" class="form-select">
            <% ages.forEach(a => { %>
              <option value="<%= a.id %>" <%= a.id === athlete.age_category_id ? 'selected' : '' %>><%= a.name %></option>
            <% }) %>
          </select>
        </div>

        <div class="col-md-3">
          <label class="form-label">Weight Category</label>
          <select name="weight_category_id" class="form-select">
            <% weights.forEach(w => { %>
              <option value="<%= w.id %>" <%= w.id === athlete.weight_category_id ? 'selected' : '' %>><%= w.name %></option>
            <% }) %>
          </select>
        </div>

        <div class="col-md-3">
          <label class="form-label">Club</label>
          <select name="club_id" class="form-select">
            <% clubs.forEach(c => { %>
              <option value="<%= c.id %>" <%= c.id === athlete.club_id ? 'selected' : '' %>><%= c.name %></option>
            <% }) %>
          </select>
        </div>

        <div class="col-md-3">
          <label class="form-label">Total Points</label>
          <input type="number" step="0.001" name="total_points" value="<%= athlete.total_points %>" class="form-control">
        </div>

        <div class="col-12">
          <button type="submit" class="btn btn-primary mt-2">💾 Save</button>
        </div>
      </form>
    </div>

    <!-- 🏆 Αποτελέσματα -->
    <div class="tab-pane fade p-3" id="results">
      <h5>Αποτελέσματα Τουρνουά</h5>
      <table class="table table-striped table-bordered align-middle text-center">
        <thead class="table-dark">
          <tr>
            <th>Τουρνουά</th>
            <th>Ημ/νία</th>
            <th>Θέση</th>
            <th>Νίκες</th>
            <th>Πόντοι</th>
            <th>Σεζόν</th>
            <th>Ενέργειες</th>
          </tr>
        </thead>
        <tbody>
          <% results.forEach(r => { %>
            <tr>
              <form action="/editor-full/<%= athlete.id %>/results/<%= r.id %>/update" method="POST" class="row g-2 align-items-center">
                <td class="col">
                  <select name="tournament_id" class="form-select form-select-sm">
                    <option value="<%= r.tournament_id %>" selected>
                      <%= r.tournament_name %> (<%= r.tournament_date %>)
                    </option>
                    <% tournaments.forEach(t => { %>
                      <option value="<%= t.id %>"><%= t.name %> (<%= t.date %>)</option>
                    <% }) %>
                  </select>
                </td>
                <td class="col"><input type="text" class="form-control form-control-sm" value="<%= r.tournament_date %>" readonly></td>
                <td class="col-1"><input type="number" name="placement" class="form-control form-control-sm" value="<%= r.placement %>"></td>
                <td class="col-1"><input type="number" name="wins" class="form-control form-control-sm" value="<%= r.wins %>"></td>
                <td class="col-1"><input type="number" step="0.001" name="points_earned" class="form-control form-control-sm" value="<%= r.points_earned %>"></td>
                <td class="col-1"><input type="number" name="season_year" class="form-control form-control-sm" value="<%= r.season_year %>"></td>
                <td class="col text-nowrap">
                  <button class="btn btn-sm btn-warning">✏️ Save</button>
                  <form action="/editor-full/<%= athlete.id %>/results/<%= r.id %>/delete" method="POST" class="d-inline">
                    <button class="btn btn-sm btn-danger" onclick="return confirm('Διαγραφή;')">🗑️</button>
                  </form>
                </td>
              </form>
            </tr>
          <% }) %>
        </tbody>
      </table>

      <hr>
      <h6>➕ Προσθήκη νέου αποτελέσματος</h6>
      <form action="/editor-full/<%= athlete.id %>/results/add" method="POST" class="row g-2">
        <div class="col-md-4">
          <select name="tournament_id" class="form-select">
            <% tournaments.forEach(t => { %>
              <option value="<%= t.id %>"><%= t.name %> (<%= t.date %>)</option>
            <% }) %>
          </select>
        </div>
        <div class="col-md-2"><input type="number" name="placement" class="form-control" placeholder="Θέση"></div>
        <div class="col-md-2"><input type="number" name="wins" class="form-control" placeholder="Νίκες"></div>
        <div class="col-md-2"><input type="number" step="0.001" name="points_earned" class="form-control" placeholder="Πόντοι"></div>
        <div class="col-md-2"><input type="number" name="season_year" class="form-control" placeholder="Σεζόν (π.χ. 2025)"></div>
        <div class="col-md-12 mt-2"><button type="submit" class="btn btn-success">💾 Προσθήκη</button></div>
      </form>
    </div>

    <!-- 💰 Πόντοι -->
    <div class="tab-pane fade p-3" id="points">
      <div class="row">
        <div class="col-md-6">
          <h5>Ιστορικό Πόντων – KUMITE</h5>
          <table class="table table-bordered table-sm text-center align-middle mb-4">
            <thead class="table-dark">
              <tr>
                <th>Ημ/νία</th>
                <th>Πριν</th>
                <th>Μετά</th>
                <th>Διαφορά</th>
                <th>Σύνολο</th>
                <th>Season</th>
                <th>Περιγραφή</th>
                <th>Ενέργειες</th>
              </tr>
            </thead>
            <tbody>
              <% (historyKumite || []).forEach(h => { %>
                <tr>
                  <form method="POST" action="/editor-full/<%= athlete.id %>/points/<%= h.id %>/update" class="row g-1">
                    <td class="col"><input type="text" class="form-control form-control-sm" value="<%= h.date %>" readonly></td>
                    <td class="col"><input type="number" step="0.001" class="form-control form-control-sm" value="<%= h.points_before %>" readonly></td>
                    <td class="col"><input type="number" step="0.001" name="points_after" class="form-control form-control-sm" value="<%= h.points_after %>"></td>
                    <td class="col"><input type="number" step="0.001" class="form-control form-control-sm" value="<%= h.delta %>" readonly></td>
                    <td class="col"><input type="number" step="0.001" name="total_after" class="form-control form-control-sm" value="<%= h.total_after %>"></td>
                    <td class="col-1"><input type="number" name="season_year" class="form-control form-control-sm" value="<%= h.season_year %>"></td>
                    <td class="col"><input type="text" name="description" class="form-control form-control-sm" value="<%= h.description || '' %>"></td>
                    <td class="col text-nowrap">
                      <button class="btn btn-sm btn-warning">✏️</button>
                      <form method="POST" action="/editor-full/<%= athlete.id %>/points/<%= h.id %>/delete" class="d-inline">
                        <button class="btn btn-sm btn-danger" onclick="return confirm('Διαγραφή;')">🗑️</button>
                      </form>
                    </td>
                  </form>
                </tr>
              <% }) %>
            </tbody>
          </table>

          <form class="row g-2" method="POST" action="/editor-full/<%= athlete.id %>/points/add/KUMITE">
            <h6>➕ Προσθήκη (KUMITE)</h6>
            <div class="col-md-3"><input type="number" step="0.001" name="total_after" class="form-control" placeholder="Total After"></div>
            <div class="col-md-2"><input type="number" name="season_year" class="form-control" placeholder="Season"></div>
            <div class="col-md-5"><input type="text" name="description" class="form-control" placeholder="Περιγραφή"></div>
            <div class="col-md-2"><button class="btn btn-success w-100">💾 Προσθήκη</button></div>
          </form>
        </div>

        <div class="col-md-6">
          <h5>Ιστορικό Πόντων – KATA</h5>
          <table class="table table-bordered table-sm text-center align-middle mb-4">
            <thead class="table-dark">
              <tr>
                <th>Ημ/νία</th>
                <th>Πριν</th>
                <th>Μετά</th>
                <th>Διαφορά</th>
                <th>Σύνολο</th>
                <th>Season</th>
                <th>Περιγραφή</th>
                <th>Ενέργειες</th>
              </tr>
            </thead>
            <tbody>
              <% (historyKata || []).forEach(h => { %>
                <tr>
                  <form method="POST" action="/editor-full/<%= athlete.id %>/points/<%= h.id %>/update" class="row g-1">
                    <td class="col"><input type="text" class="form-control form-control-sm" value="<%= h.date %>" readonly></td>
                    <td class="col"><input type="number" step="0.001" class="form-control form-control-sm" value="<%= h.points_before %>" readonly></td>
                    <td class="col"><input type="number" step="0.001" name="points_after" class="form-control form-control-sm" value="<%= h.points_after %>"></td>
                    <td class="col"><input type="number" step="0.001" class="form-control form-control-sm" value="<%= h.delta %>" readonly></td>
                    <td class="col"><input type="number" step="0.001" name="total_after" class="form-control form-control-sm" value="<%= h.total_after %>"></td>
                    <td class="col-1"><input type="number" name="season_year" class="form-control form-control-sm" value="<%= h.season_year %>"></td>
                    <td class="col"><input type="text" name="description" class="form-control form-control-sm" value="<%= h.description || '' %>"></td>
                    <td class="col text-nowrap">
                      <button class="btn btn-sm btn-warning">✏️</button>
                      <form method="POST" action="/editor-full/<%= athlete.id %>/points/<%= h.id %>/delete" class="d-inline">
                        <button class="btn btn-sm btn-danger" onclick="return confirm('Διαγραφή;')">🗑️</button>
                      </form>
                    </td>
                  </form>
                </tr>
              <% }) %>
            </tbody>
          </table>

          <form class="row g-2" method="POST" action="/editor-full/<%= athlete.id %>/points/add/KATA">
            <h6>➕ Προσθήκη (KATA)</h6>
            <div class="col-md-3"><input type="number" step="0.001" name="total_after" class="form-control" placeholder="Total After"></div>
            <div class="col-md-2"><input type="number" name="season_year" class="form-control" placeholder="Season"></div>
            <div class="col-md-5"><input type="text" name="description" class="form-control" placeholder="Περιγραφή"></div>
            <div class="col-md-2"><button class="btn btn-success w-100">💾 Προσθήκη</button></div>
          </form>
        </div>
      </div>
    </div>

    <!-- 📈 Εποχές -->
    <div class="tab-pane fade p-3" id="seasons">
      <h5>Εποχικά Στοιχεία Πόντων</h5>
      <table class="table table-bordered table-sm mt-2">
        <thead class="table-dark text-center">
          <tr>
            <th>Έτος</th>
            <th>Closing Points</th>
            <th>Starting Points</th>
            <th>Raw Closing</th>
            <th>Ενέργειες</th>
          </tr>
        </thead>
        <tbody class="text-center">
          <% (yearlyData || []).forEach(y => { %>
            <tr>
              <form method="POST" action="/editor-full/<%= athlete.id %>/yearly/<%= y.id %>/update" class="row g-1">
                <td class="col-2"><input type="number" name="year" value="<%= y.year %>" class="form-control form-control-sm"></td>
                <td class="col-3"><input type="number" step="0.001" name="closing_points" value="<%= y.closing_points %>" class="form-control form-control-sm"></td>
                <td class="col-3"><input type="number" step="0.001" name="starting_points" value="<%= y.starting_points %>" class="form-control form-control-sm"></td>
                <td class="col-3"><input type="number" step="0.001" name="closing_raw_points" value="<%= y.closing_raw_points %>" class="form-control form-control-sm"></td>
                <td class="col text-nowrap">
                  <button class="btn btn-sm btn-warning">✏️</button>
                  <form method="POST" action="/editor-full/<%= athlete.id %>/yearly/<%= y.id %>/delete" class="d-inline">
                    <button class="btn btn-sm btn-danger" onclick="return confirm('Διαγραφή;')">🗑️</button>
                  </form>
                </td>
              </form>
            </tr>
          <% }) %>
        </tbody>
      </table>

      <hr>
      <h6>➕ Προσθήκη season line</h6>
      <form method="POST" action="/editor-full/<%= athlete.id %>/yearly/add" class="row g-2">
        <div class="col-md-2"><input type="number" name="year" class="form-control" placeholder="Έτος (π.χ. 2024)"></div>
        <div class="col-md-3"><input type="number" step="0.001" name="closing_points" class="form-control" placeholder="Closing"></div>
        <div class="col-md-3"><input type="number" step="0.001" name="starting_points" class="form-control" placeholder="Starting"></div>
        <div class="col-md-3"><input type="number" step="0.001" name="closing_raw_points" class="form-control" placeholder="Raw Closing"></div>
        <div class="col-md-1"><button class="btn btn-success w-100">💾</button></div>
      </form>
    </div>
  </div>
</div>
